[

{
"id": "-200905-ytcodecs",
"title": "もうYouTubeにMP4でアップロードするのやめません？",
"author": null,
"tags": ["YouTube", "ファイル拡張子", "ファイルフォーマット"],
"url": "/200905/ytcodecs/",
"date": "2020-09-05",
"content": "  「動画の画質や音質なんて別に気にしてないよ」という方を対象にはしていません。今でも、YouTubeで活動されている多くの日本人は、MP4でアップロードされている動画が多いです。しかし、すでに海外では、WebMという形式など、MP4以外のほかの形式でアップロードしている方が多く見受けられます。だから、日本人もWebMでアップロードしよう！といってもあれなので、WebMにするとどんなメリットがあるかを紹介します。YouTubeは、VP9で動画を再生している。MP4では、h264という形式で動画がエンコードされているのが多いのに対し、WebMは、VP9という動画でエンコードされているものがあります。で、VP9とは何なのか？簡単に言うと、h264よりも、少ない容量で、高画質な動画を再生できるビデオコーデックというものです。 (ブログ主の調査では、とある動画をエンコードしたとき、h264が166MBだったのに対し、VP9は109MBだった。)よくh264動画で指摘されていブロックノイズ問題も、VP9では、それを同じ容量(ビットレート)でも軽減が期待できます。ということは、動画を作る側も、VP9でアップロードすれば、より高画質な動画を期待できるようになります。YouTube側も、VP9のアップロード、再生に対応していて、最近では、ほとんどの動画がVP9で再生されるようになっています。VP9、Opusを使用していると表示されているYouTubeの詳細統計情報ただし、対応ブラウザではないと見れないので、例えば、  Internet Explorer (Windows)  Safari (macOS X)はVP9非対応です。(これらのブラウザでは、h264で再生されます。)VP9で視聴するには、  Google Chrome  FireFox  Microsoft Edge (EdgeHTML / Chromium)  その他 Chromiumベースブラウザ (Opera, Vivaldi等)等で見る必要があります。いずれのブラウザもWindows, Mac共に対応、Edge以外のブラウザはLinuxにも対応しています。(OS自体が動画再生の要件を満たす必要があります。)YouTubeの音質は、もう悪くない！MP4では、AACという音声コーデックが使用されてきました。AACはMP3に比べ、比較的少ない容量でも高音質が期待できましたが、やはりCDに比べ、数値的には劣れていました。以前はYouTube側も、最高音質AAC 192kbpsで再生されていました。(しかし、これでも音質的にはあまり違和感を感じなかった方が多いと思います。)しかし、現在ではOpusという形式で再生されています。YouTube側で再生されている、Opus (128kbps VBR)は、ほとんどCDと聞き分けができないとされています。(下手するとハイレゾと聞き比べてもわからないほど。)具体的な数値でいうと、            コーデック      ビットレート      カットオフ周波数                  AAC      128 kbps      15.8 kHz              Opus      128 kbps VBR      20.0 kHz      と、Opusの音質が圧倒的であることがわかります。(カットオフ周波数が、音質のすべてはありません。)(YouTubeで再生されているAACは、上の表のAACとカットオフ周波数が異なる可能性があります。)つまり、YouTubeの音質は、低い容量でも、人間の耳では聞き分けがかなり難しいほど品質が良くなりました。YouTubeでOpus形式の動画を再生したときのスペクトラム画像20.0kHzでカットされている。そのため、AAC 320kbpsやOpus、PCMやFLACでアップロードすれば、充分な音質が期待できます。音質を特に気にしないでアップロードするなら、WebMのOpusで十分ですし、音質重視なら、ロスレスFLACや、PCMでMKVに直接埋め込むことで、再エンコード回数を１回にすることができます。ただし、Opusを再生するにも、対応ブラウザが必要で、対応ブラウザ  Google Chrome  FireFox  Microsoft Edge (EdgeHTML / Chromium)  その他 Chromiumベースブラウザ (Opera, Vivaldi等)非対応ブラウザ (AACで再生)  Internet Explorer (Windows)  Safari (macOS X)となっております。YouTubeは再エンコードしているYouTubeに動画をアップロードするためには、動画を編集ソフトで書き出し(エンコード)を行う必要があります。しかし、YouTubeにアップロードされた動画は、YouTube側でも再書き出し(再エンコード)が行われます。そのため、アップロードされた動画がそのままの品質で再生されることはありません。しかも、MP4でアップロードされた動画も、YouTube側でWebMで再エンコードが行われるのですが、元(MP4)の品質が悪いと、いくらWebM(VP9, Opus)でも元の品質よりよくなることはありません。ということは、品質を気にするなら再エンコードされる形式よりもいいものでアップロードする必要があります。しかし、そのためにMP4の動画容量(ビットレート)を上げるのは、あまり効率的ではありません。その代わりに、十分な品質ののWebM(VP9, Opus)にすれば、アップロード時の容量がMP4より小さく、そしてYouTube側できれいな動画を再生できることが期待できます。実はVP9ももう古い？先ほど、VP9でアップロードすることで、より高画質な動画を期待できると述べましたが、実は、YouTubeは新たなビデオコーデックへの対応が進んでいます。それは、 h265 (HEVC) ではなく、現在急上昇中のAV1というものです。AV1と表示されているYouTubeの詳細統計情報日本でも上位のYouTubeクリエイターでこのコーデックを再生できることが多い(ただし、元がMP4なのでそこまで期待できないが)AV1は、多くの企業に支持されている新しいコーデックで、すでにYouTubeの他にも、Netflixが対応しています。AV1は、h265 (HEVC)やVP9に比べ、さらに圧縮率が向上していて、次の動画コーデックの実質標準規格になるとも噂されています。ただし、まだAV1はエンコードに大変時間がかかり、個人用途としては少し微妙です。(ブログ主の調査では、ffmpegでエンコードしたとき、AV1はVP9に比べて10倍遅い。)まとめMP4は、今では同じ容量でも画質が悪い、音も悪いとメリットがないので、これからYouTubeに動画をアップロードするときは、WebMのVP9、Opusでアップロードしましょう。同じ画質、音質でも動画ファイルの容量が小さくなることが期待できます。なお、WebM形式で出力するのには、Adobe Premiere Proは追加のプラグインが必要です。AviUtlも別のプラグインが必要です。ただし、AviUtlのプラグインは今のところGUIでWebMを細かく調整できるプラグインは作られていません。(ただし、CUIならある。)ffmpegは、VP9, AV1, Opusともにデコード、エンコードがサポートされています。なお、個人的におすすめな設定も載せておきます。            解像度      フレーム数      映像コーデック      映像ビットレート      音声コーデック      音声ビットレート                  1280x720      30 FPS      VP9      5 Mbps      Opus      128kbps VBR              1280x720      60 FPS      VP9      5 Mbps      Opus      128kbps VBR              1920x1080      30 FPS      VP9      10 Mbps      Opus      128kbps VBR              1920x1080      60 FPS      VP9      10 Mbps      Opus      128kbps VBR              2560x1440      30 FPS      VP9      20 Mbps      Opus      128kbps VBR              2560x1440      60 FPS      VP9      20 Mbps      Opus      128kbps VBR              3840x2160      30 FPS      VP9      40 Mbps      Opus      128kbps VBR              3840x2160      60 FPS      VP9      40 Mbps      Opus      128kbps VBR      "
}, 

{
"id": "-200830-sl",
"title": "WindowsでSLを走らせたい",
"author": null,
"tags": ["Windows", "Linux", "Ubuntu", "備忘録"],
"url": "/200830/sl/",
"date": "2020-08-30",
"content": "SL for Win32 Console新山(へろぱ) 様によりSL for Win32 Consoleが公開されているのでそれを使えばOK。しかも音が鳴るという謎仕様 神仕様。Windows Subsystem for Linuxdism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all「Windowsの機能の有効化または無効化」よりWSLを有効化。再起動後、Microsoft Storeから好きなディストリビューションをダウンロード、インストールして初期設定。その後、PS &gt; wsl.exe(WSL) $ sudo apt update(WSL) $ sudo apt install sl(WSL) $ slでSLが拝める。PATH内に@wsl.exe sl %*%をsl.batで保存すれば、直接呼べるようになる。ただ、自分の環境だとなぜか爆速でSLが走り去ってしまうので、次の方法を試した。MinGW-gcc でビルドgit clone https://github.com/mtoyoda/sl.gitcd slをして gcc -o sl.exe sl.c でできるかと思ったらできなかったので、結果的にmingw-get install mingw32-libncurses # すでに行われているなら不要Set-Variable mingw_path (MinGWのパス)gcc -I ${mingw_path}\\include\\ncurses -o sl.exe sl.c ${mingw_path}\\lib\\libncurses.a.\\sl.exeでできた。なんかすごい遅いけど満足満足。ちなみにこれを実行した後に、もう一回WSLで実行したらこれぐらい遅くなった…謎。"
}, 

{
"id": "-200823-hello",
"title": "Hello, World",
"author": null,
"tags": [],
"url": "/200823/hello/",
"date": "2020-08-23",
"content": "Hello, WorldHello Blog!!"
}

]
